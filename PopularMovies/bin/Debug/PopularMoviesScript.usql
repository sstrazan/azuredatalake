// Auto-generated header code
// Generated Code Behind Header

CREATE ASSEMBLY [__codeBehind_uswziwsp.rds] FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300B9A39E590000000000000000E00002210B010B00000800000006000000000000BE270000002000000040000000000010002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000642700005700000000400000E802000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000C4070000002000000008000000020000000000000000000000000000200000602E72737263000000E80200000040000000040000000A0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000E00000000000000000000000000004000004200000000000000000000000000000000A0270000000000004800000002000500182400004C030000010000000000000068200000B0030000000000000000000000000000000000000000000000000000000000000000000000000000000000003E0F00280300000A16186F0400000A2A1E02280500000A2ABE010000EFBBBF7573696E67204D6963726F736F66742E416E616C79746963732E496E74657266616365733B0D0A7573696E67204D6963726F736F66742E416E616C79746963732E54797065732E53716C3B0D0A7573696E672053797374656D3B0D0A7573696E672053797374656D2E436F6C6C656374696F6E732E47656E657269633B0D0A7573696E672053797374656D2E494F3B0D0A7573696E672053797374656D2E4C696E713B0D0A7573696E672053797374656D2E546578743B0D0A0D0A6E616D65737061636520506F70756C61724D6F766965730D0A7B0D0A202020207075626C696320636C61737320437573746F6D46756E6374696F6E730D0A202020207B0D0A20202020202020207075626C69632073746174696320737472696E67205061727365556E697854696D657374616D70436F6465426568696E6428646F75626C6520756E697854696D655374616D70290D0A20202020202020207B0D0A20202020202020202020202072657475726E20756E697854696D655374616D702E546F537472696E6728292E537562737472696E6728302C2032293B0D0A20202020202020207D0D0A0D0A20202020202020200D0A202020207D0D0A7D0D0A000000000000E40100003C3F786D6C2076657273696F6E3D22312E30223F3E0D0A3C41727261794F66537472696E6720786D6C6E733A7873693D22687474703A2F2F7777772E77332E6F72672F323030312F584D4C536368656D612D696E7374616E63652220786D6C6E733A7873643D22687474703A2F2F7777772E77332E6F72672F323030312F584D4C536368656D61223E0D0A20203C737472696E673E4D6963726F736F66742E416E616C79746963732E446961676E6F73746963732E646C6C3C2F737472696E673E0D0A20203C737472696E673E4D6963726F736F66742E416E616C79746963732E496E74657266616365732E646C6C3C2F737472696E673E0D0A20203C737472696E673E4D6963726F736F66742E416E616C79746963732E496E74657266616365732E53747265616D696E672E646C6C3C2F737472696E673E0D0A20203C737472696E673E4D6963726F736F66742E416E616C79746963732E54797065732E646C6C3C2F737472696E673E0D0A20203C737472696E673E53797374656D2E646C6C3C2F737472696E673E0D0A20203C737472696E673E53797374656D2E436F72652E646C6C3C2F737472696E673E0D0A20203C737472696E673E53797374656D2E446174612E646C6C3C2F737472696E673E0D0A3C2F41727261794F66537472696E673E42534A4201000100000000000C00000076342E302E33303331390000000005006C00000014010000237E0000800100006801000023537472696E677300000000E80200000800000023555300F0020000100000002347554944000000000300004C00000023426C6F620000000000000002000001471500000901000000FA2533001600000100000005000000020000000200000001000000050000000200000001000000010000000200000000000A00010000000000060056004F000600AE008E000600CE008E00060006014F00060016014F000000000001000000000001000100010010002800380005000100010050200000000096005D000A00010060200000000086187A000F00020000000100800011007A00130019007A000F0021000D01180029001D011C0009007A000F002E000B0022002E0013002B00048000000000000000000000000000000000EC0000000400000000000000000000000100460000000000000000000100000027010000C801000001000000430100000000003C4D6F64756C653E005F5F636F6465426568696E645F7573777A697773702E7264732E646C6C00437573746F6D46756E6374696F6E7300506F70756C61724D6F76696573006D73636F726C69620053797374656D004F626A656374005061727365556E697854696D657374616D70436F6465426568696E64002E63746F7200756E697854696D655374616D700053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465005F5F636F6465426568696E645F7573777A697773702E72647300446F75626C6500546F537472696E6700537472696E6700537562737472696E6700506F70756C61724D6F766965735363726970742E7573716C2E63730041444C546F6F6C5F436F6465626568696E645F5265666572656E6365732E786D6C0000000000032000000000002B36E4246CF19B4CA8CBB5D6FC96B5330008B77A5C561934E0890400010E0D0320000104200101080320000E0520020E08080801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100008C2700000000000000000000AE270000002000000000000000000000000000000000000000000000A02700000000000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000008C02000000000000000000008C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004EC010000010053007400720069006E006700460069006C00650049006E0066006F000000C801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000005C001E00010049006E007400650072006E0061006C004E0061006D00650000005F005F0063006F006400650042006500680069006E0064005F007500730077007A0069007700730070002E007200640073002E0064006C006C0000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000064001E0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005F005F0063006F006400650042006500680069006E0064005F007500730077007A0069007700730070002E007200640073002E0064006C006C000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E00300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000C03700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;

REFERENCE ASSEMBLY [__codeBehind_uswziwsp.rds];


DEPLOY RESOURCE @"C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.5.2\System.Core.dll";
// Generated Code Behind Header

// Auto-generated header code ended

// User script
REFERENCE ASSEMBLY master.PopularMoviesCommon;

//USING x = PopularMoviesCommon.CustomFunctions;
USING y = PopularMoviesCommon.Extractors.MoviesInfoExtractor;

DECLARE @movieRatingsFilePath = "/u.data";
DECLARE @movieDataFilePath = "/u100k.item";

// extract all ratings data from file
//@moviesRatings =
//    EXTRACT UserId int,
//            MovieId int,
//            Rating int,
//			Timestamp double
//    FROM @movieRatingsFilePath
//    USING Extractors.Tsv();

// count ratings per movie
//@ratingsCountPerMovie =
//    SELECT MovieId,
//           COUNT( * ) AS NumberOfRatings
//    FROM @moviesRatings
//    GROUP BY MovieId;

//@timestampParsed =
//    SELECT UserId,
//           MovieId,
//           Rating,
////           PopularMovies.CustomFunctions.ParseUnixTimestampCodeBehind(Timestamp) AS ParsedUnixTimestamp
//          x.UnixTimeStampToDateTime(Timestamp).ToString("yyyy.MM.dd HH:mm") AS ParsedUnixTimestamp
//    FROM @moviesRatings;

//get movies info
@moviesInfo =
    EXTRACT MovieId int,
            Title string,
            ReleaseDate DateTime,
            VideoReleaseDate DateTime?,
            IMDbURL string,
            GenreUnknown bool,
            GenreAction bool,
            GenreAdventure bool,
            GenreAnimation bool,
            GenreChildrens bool,
            GenreComedy bool,
            GenreCrime bool,
            GenreDocumentary bool,
            GenreDrama bool,
            GenreFantasy bool,
            GenreNoire bool,
            GenreHorror bool,
            GenreMusical bool,
            GenreMystery bool,
            GenreRomance bool,
            GenreSciFi bool,
            GenreThriller bool,
            GenreWar bool,
            GenreWestern bool
    FROM @movieDataFilePath
    USING new PopularMoviesCommon.Extractors.MoviesInfoExtractor(colDelim: '|');
			
OUTPUT @moviesInfo
TO "/moviesInfo.csv"
//ORDER BY NumberOfRatings DESC FETCH 10 ROWS
USING Outputters.Csv();
// User script ended
// Auto-generated footer code
// Generated Code Behind Footer
USE DATABASE [master];
USE SCHEMA [dbo];

DROP ASSEMBLY [__codeBehind_uswziwsp.rds];

// Generated Code Behind Footer

// Auto-generated footer code ended

